# URL Routing Design

Adds URL-based navigation to the UI so users can refresh the page without losing state, bookmark specific views, and share links.

## URL Structure

| Path                           | Description                                      |
| ------------------------------ | ------------------------------------------------ |
| `/`                            | Splash screen with large "Stellaris Stats" title |
| `/saves/$saveId/empire_budget` | Empire budget view for selected save             |

**Search params for `/empire_budget`:**

- `category` — One of: `basic`, `advanced`, `basic_strategic`, `advanced_strategic`, `abstract`, `research`. Defaults to `basic`.

**Examples:**

```
/                                                    → Splash screen
/saves/unitednationsofearth_-15512622/empire_budget  → Basic resources (default)
/saves/unitednationsofearth_-15512622/empire_budget?category=research  → Research view
```

**Future extensibility:** New views become new routes:

- `/saves/$saveId/fleet`
- `/saves/$saveId/planets`

## Technology

**Router:** TanStack Router with file-based routing

**Validation:** Zod with `@tanstack/router-zod-adapter` for type-safe search params (no `as` casts)

**Dependencies:**

```
@tanstack/react-router
@tanstack/router-zod-adapter
@tanstack/router-plugin (Vite plugin)
@tanstack/router-devtools (dev only, optional)
```

## Layout

```
┌─────────────┬──────────────┬─────────────────────────────┐
│   Saves     │  View Menu   │      Main Content           │
│   List      │              │                             │
│             │ • Empire     │   Empire Budget             │
│  [Save 1]   │   Budget ◄   │   [category tabs]           │
│  [Save 2]   │              │   [chart]                   │
│  [Save 3]   │              │   [legend]                  │
│             │              │                             │
└─────────────┴──────────────┴─────────────────────────────┘
```

- **Saves sidebar** (fit-content) — Always visible, lists available saves, width adjusts to content
- **View menu sidebar** (160px) — Appears after save selection, shows available views
- **Main content** — Splash screen or selected view

## Route Files

```
ui/src/
  routes/
    __root.tsx              # Root layout (sidebars + outlet)
    index.tsx               # Splash screen at /
    saves/
      $saveId/
        empire_budget.tsx   # Budget view
  routeTree.gen.ts          # Auto-generated by Vite plugin
```

## Search Params Validation

```typescript
import { z } from 'zod'
import { zodSearchValidator } from '@tanstack/router-zod-adapter'

const categories = [
  'basic',
  'advanced',
  'basic_strategic',
  'advanced_strategic',
  'abstract',
  'research',
] as const

const searchSchema = z.object({
  category: z.enum(categories).catch('basic'),
})

export const Route = createFileRoute('/saves/$saveId/empire_budget')({
  validateSearch: zodSearchValidator(searchSchema),
})
```

Zod's `.catch('basic')` provides the default when validation fails.

## Component Changes

| Component                                         | Changes                                                                       |
| ------------------------------------------------- | ----------------------------------------------------------------------------- |
| `App.tsx`                                         | Remove `selectedFilename` state, becomes `<RouterProvider>` wrapper           |
| `SaveList.tsx`                                    | Use `<Link>` for navigation, read `saveId` via `useParams({ strict: false })` |
| `BudgetDashboard.tsx`                             | Get `saveId` from `Route.useParams()`, `category` from `Route.useSearch()`    |
| `TimeSeriesChart.tsx`                             | No changes                                                                    |
| **New:** `routes/__root.tsx`                      | Layout with both sidebars + outlet                                            |
| **New:** `routes/index.tsx`                       | Splash screen component                                                       |
| **New:** `routes/saves/$saveId/empire_budget.tsx` | Route definition + view                                                       |
| **New:** View menu sidebar component              | Navigation between views                                                      |

## State Migration

**Moves to URL:**

- `selectedFilename` → URL path param `$saveId`
- `selectedCategory` → URL search param `category`

**Stays in React (ephemeral):**

- `hoveredIndex` — Chart interaction
- `hiddenResources` — Legend toggles

## Splash Screen

Large centered "Stellaris Stats" title using Orbitron font with glow effect. Displays when no save is selected (`/` route).

## Vite Configuration

```typescript
import { TanStackRouterVite } from '@tanstack/router-plugin/vite'

export default defineConfig({
  plugins: [TanStackRouterVite(), react(), vanillaExtractPlugin()],
})
```

## References

- Component specifications: `docs/components/`
